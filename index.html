<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Milestone Watch Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #050505; }
        .glow-nba { text-shadow: 0 0 20px rgba(249, 115, 22, 0.4); }
        .glow-nhl { text-shadow: 0 0 20px rgba(59, 130, 246, 0.4); }
        .player-card { transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .player-card:hover { transform: translateY(-10px); border-color: rgba(255,255,255,0.2); cursor: pointer; }
        
        /* Modal Animation */
        .modal-enter { opacity: 0; transform: scale(0.9); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: opacity 300ms, transform 300ms; }
        .modal-exit { opacity: 1; transform: scale(1); }
        .modal-exit-active { opacity: 0; transform: scale(0.9); transition: opacity 200ms, transform 200ms; }
    </style>
</head>
<body class="text-white min-h-screen">
    <div class="container mx-auto px-4 py-12">
        <header class="text-center mb-16">
            <div class="flex flex-wrap justify-center gap-4 mb-10">
                <button onclick="switchLeague('nba')" class="px-10 py-3 rounded-2xl border-2 border-orange-600/30 font-black hover:border-orange-500 transition-all focus:outline-none focus:ring-2 focus:ring-orange-500">üèÄ NBA</button>
                <button onclick="switchLeague('nhl')" class="px-10 py-3 rounded-2xl border-2 border-blue-600/30 font-black hover:border-blue-500 transition-all focus:outline-none focus:ring-2 focus:ring-blue-500">üèí NHL</button>
            </div>
            <h1 id="title" class="text-7xl md:text-9xl font-black tracking-tighter glow-nba italic text-orange-500 uppercase transition-all duration-500">MILESTONE WATCH</h1>
            <p id="sub-title" class="text-zinc-500 text-xl mt-4">Select a league to track history in the making.</p>
        </header>

        <div id="player-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8"></div>
        
        <div id="state-container" class="flex flex-col items-center justify-center py-32 text-zinc-700">
            <div id="loading-spinner" class="hidden mb-6 w-12 h-12 border-4 border-white/10 border-t-orange-500 rounded-full animate-spin"></div>
            <p id="state-text" class="text-2xl font-bold tracking-tight">Select a league to begin</p>
        </div>
    </div>

    <!-- PLAYER DETAIL MODAL -->
    <div id="modal-backdrop" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4" onclick="closeModal(event)">
        <div id="modal-content" class="bg-zinc-900 border border-white/10 rounded-3xl max-w-lg w-full p-8 shadow-2xl relative transform transition-all modal-enter">
            
            <!-- Close Button -->
            <button onclick="closeModal(event, true)" class="absolute top-4 right-4 text-zinc-500 hover:text-white transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>

            <!-- Modal Body -->
            <div class="flex flex-col items-center text-center">
                <div class="relative mb-6">
                    <img id="m-image" src="" class="w-32 h-32 object-cover rounded-full border-4 border-white/10 bg-zinc-800 shadow-xl">
                    <div id="m-team-badge" class="absolute bottom-0 right-0 bg-zinc-800 text-xs font-bold px-2 py-1 rounded border border-zinc-600">TEAM</div>
                </div>
                
                <h2 id="m-name" class="text-4xl font-black tracking-tight mb-2">Player Name</h2>
                <p id="m-needed" class="text-xl font-bold text-orange-500 mb-8">Needs 50 Points</p>

                <!-- Stats Grid -->
                <div class="grid grid-cols-2 gap-4 w-full mb-8">
                    <div class="bg-zinc-800/50 p-4 rounded-xl border border-white/5">
                        <p class="text-xs text-zinc-500 uppercase font-bold mb-1">Season Avg</p>
                        <p id="m-season-avg" class="text-2xl font-black text-white">--</p>
                    </div>
                    <div class="bg-zinc-800/50 p-4 rounded-xl border border-white/5">
                        <p class="text-xs text-zinc-500 uppercase font-bold mb-1">Last 5 Games</p>
                        <p id="m-last5-avg" class="text-2xl font-black text-white">--</p>
                    </div>
                </div>

                <!-- Betting Line Placeholder -->
                <div class="w-full bg-zinc-800/30 p-4 rounded-xl border border-white/5 flex justify-between items-center mb-6">
                    <div class="text-left">
                        <p class="text-xs text-zinc-500 uppercase font-bold">Sportsbook Line (Est)</p>
                        <p class="text-sm text-zinc-400">O/U Points</p>
                    </div>
                    <div class="text-right">
                        <span class="bg-zinc-700 text-zinc-400 text-xs px-2 py-1 rounded">OFFLINE</span>
                        <p class="text-lg font-bold text-white mt-1">--</p>
                    </div>
                </div>
                
                <p class="text-xs text-zinc-600 italic">Betting data requires live API subscription.</p>
            </div>
        </div>
    </div>

    <script>
        // Global to store current players for modal lookup
        let currentPlayersData = [];

        async function switchLeague(league) {
            const grid = document.getElementById('player-grid');
            const stateText = document.getElementById('state-text');
            const spinner = document.getElementById('loading-spinner');
            const title = document.getElementById('title');
            
            grid.innerHTML = '';
            spinner.classList.remove('hidden');
            stateText.innerText = "Accessing league data...";
            
            // Toggle Title Styling
            if (league === 'nba') {
                title.className = "text-7xl md:text-9xl font-black tracking-tighter glow-nba italic text-orange-500 uppercase transition-all";
                title.innerText = "HOOP TRACKER";
                spinner.className = "mb-6 w-12 h-12 border-4 border-white/10 border-t-orange-500 rounded-full animate-spin";
            } else {
                title.className = "text-7xl md:text-9xl font-black tracking-tighter glow-nhl italic text-blue-500 uppercase transition-all";
                title.innerText = "PUCK TRACKER";
                spinner.className = "mb-6 w-12 h-12 border-4 border-white/10 border-t-blue-500 rounded-full animate-spin";
            }

            try {
                const res = await fetch(`${league}_milestones.json?v=${Date.now()}`);
                if (!res.ok) throw new Error("Data not found");
                
                let players = await res.json();
                currentPlayersData = players; // Store for modal
                players.sort((a, b) => a.needed - b.needed);

                spinner.classList.add('hidden');
                stateText.innerText = players.length === 0 ? "No active milestones detected." : "";
                
                players.forEach((p, index) => {
                    const card = document.createElement('div');
                    card.className = "player-card bg-zinc-900/40 rounded-[2.5rem] p-8 border border-white/5 flex flex-col items-center text-center backdrop-blur-md";
                    card.onclick = () => openModal(index, league); // Add click handler
                    
                    const accent = league === 'nba' ? 'text-orange-500' : 'text-blue-500';
                    const urgency = p.needed <= 15 ? 'text-red-500 animate-pulse' : accent;

                    const fallbackChain = league === 'nhl' 
                        ? `this.onerror=null; this.src='https://cms.nhl.bamgrid.com/images/headshots/current/168x168/${p.player_id}.jpg'; this.onerror=function(){this.src='https://via.placeholder.com/260x190/111/fff?text=${p.player_name.charAt(0)}'}`
                        : `this.src='https://via.placeholder.com/260x190/111/fff?text=${p.player_name.charAt(0)}'`;

                    card.innerHTML = `
                        <div class="relative mb-6">
                            <img src="${p.image_url}" 
                                 onerror="${fallbackChain}" 
                                 class="w-40 h-40 object-cover rounded-full border-4 border-white/10 bg-zinc-800 shadow-2xl pointer-events-none">
                        </div>
                        <h2 class="text-3xl font-black mb-1 tracking-tight leading-tight pointer-events-none">${p.player_name}</h2>
                        <div class="px-4 py-1 rounded-full text-[10px] font-black text-zinc-500 tracking-widest uppercase mb-6 bg-white/5 border border-white/5 pointer-events-none">${p.team}</div>
                        <div class="grid grid-cols-2 gap-4 w-full mb-8 pointer-events-none">
                            <div class="bg-white/5 rounded-2xl py-3"><p class="text-[9px] text-zinc-500 font-black uppercase">Current</p><p class="text-xl font-bold">${p.current_stat.toLocaleString()}</p></div>
                            <div class="bg-white/5 rounded-2xl py-3"><p class="text-[9px] text-zinc-500 font-black uppercase">Target</p><p class="text-xl font-bold">${p.target_milestone.toLocaleString()}</p></div>
                        </div>
                        <p class="text-[10px] text-zinc-400 font-black uppercase tracking-widest mb-1 pointer-events-none">Remaining</p>
                        <p class="text-7xl font-black ${urgency} tracking-tighter pointer-events-none">${p.needed}</p>
                    `;
                    grid.appendChild(card);
                });
            } catch (e) {
                spinner.classList.add('hidden');
                stateText.innerHTML = `<div class="text-center"><div class="mb-2">Data file not found.</div><div class="text-sm font-normal text-zinc-500">Run the python script.</div></div>`;
            }
        }

        // --- MODAL LOGIC ---
        function openModal(index, league) {
            const player = currentPlayersData[index];
            const modal = document.getElementById('modal-backdrop');
            const content = document.getElementById('modal-content');
            
            // Populate Data
            document.getElementById('m-name').innerText = player.player_name;
            document.getElementById('m-image').src = player.image_url;
            document.getElementById('m-team-badge').innerText = player.team || "NBA";
            
            const statType = league === 'nhl' ? "Goals" : "Points";
            document.getElementById('m-needed').innerText = `${player.needed} ${statType} Needed`;
            
            // Handle stats that might be undefined in older JSONs
            document.getElementById('m-season-avg').innerText = player.season_avg ? player.season_avg : "--";
            document.getElementById('m-last5-avg').innerText = player.last_5_avg ? player.last_5_avg : "--";
            
            // Color Logic
            const accent = league === 'nba' ? 'text-orange-500' : 'text-blue-500';
            document.getElementById('m-needed').className = `text-xl font-bold ${accent} mb-8`;

            // Show
            modal.classList.remove('hidden');
            content.classList.remove('modal-exit', 'modal-exit-active');
            content.classList.add('modal-enter-active');
        }

        function closeModal(e, force = false) {
            if (force || e.target.id === 'modal-backdrop') {
                const modal = document.getElementById('modal-backdrop');
                const content = document.getElementById('modal-content');
                
                content.classList.remove('modal-enter-active');
                content.classList.add('modal-exit-active');
                
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 200);
            }
        }

        window.onload = () => switchLeague('nba');
    </script>
</body>
</html>