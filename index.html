<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Milestone Watch Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #050505; }
        .glow-nba { text-shadow: 0 0 20px rgba(249, 115, 22, 0.4); }
        .glow-nhl { text-shadow: 0 0 20px rgba(59, 130, 246, 0.4); }
        .player-card { transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .player-card:hover { transform: translateY(-10px); border-color: rgba(255,255,255,0.2); cursor: pointer; }
        
        /* Modal Animation */
        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: all 300ms cubic-bezier(0.34, 1.56, 0.64, 1); }
        .modal-exit { opacity: 1; transform: scale(1); }
        .modal-exit-active { opacity: 0; transform: scale(0.95); transition: opacity 200ms; }
    </style>
</head>
<body class="text-white min-h-screen">
    <div class="container mx-auto px-4 py-12">
        <header class="text-center mb-16">
            <div class="flex flex-wrap justify-center gap-4 mb-10">
                <button onclick="switchLeague('nba')" class="px-10 py-3 rounded-2xl border-2 border-orange-600/30 font-black hover:border-orange-500 transition-all focus:outline-none focus:ring-2 focus:ring-orange-500">üèÄ NBA</button>
                <button onclick="switchLeague('nhl')" class="px-10 py-3 rounded-2xl border-2 border-blue-600/30 font-black hover:border-blue-500 transition-all focus:outline-none focus:ring-2 focus:ring-blue-500">üèí NHL</button>
            </div>
            <h1 id="title" class="text-7xl md:text-9xl font-black tracking-tighter glow-nba italic text-orange-500 uppercase transition-all duration-500">MILESTONE WATCH</h1>
            <p id="sub-title" class="text-zinc-500 text-xl mt-4">Select a league to track history in the making.</p>
        </header>

        <div id="player-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8"></div>
        
        <div id="state-container" class="flex flex-col items-center justify-center py-32 text-zinc-700">
            <div id="loading-spinner" class="hidden mb-6 w-12 h-12 border-4 border-white/10 border-t-orange-500 rounded-full animate-spin"></div>
            <p id="state-text" class="text-2xl font-bold tracking-tight">Select a league to begin</p>
        </div>
    </div>

    <!-- PLAYER DETAIL MODAL -->
    <div id="modal-backdrop" class="fixed inset-0 bg-black/80 backdrop-blur-md hidden z-50 flex items-center justify-center p-4" onclick="closeModal(event)">
        <div id="modal-content" class="bg-zinc-900 border border-white/10 rounded-3xl max-w-2xl w-full p-8 shadow-2xl relative transform transition-all modal-enter overflow-hidden">
            
            <!-- Background Glow -->
            <div class="absolute top-0 left-0 w-full h-32 bg-gradient-to-b from-white/5 to-transparent pointer-events-none"></div>

            <!-- Close Button -->
            <button onclick="closeModal(event, true)" class="absolute top-4 right-4 text-zinc-400 hover:text-white transition-colors z-10 p-2 bg-black/20 rounded-full">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>

            <!-- Modal Header -->
            <div class="relative flex flex-col md:flex-row items-center gap-6 mb-8 z-10">
                <div class="relative">
                    <img id="m-image" src="" class="w-32 h-32 object-cover rounded-full border-4 border-zinc-800 shadow-xl bg-zinc-800">
                    <img id="m-team-logo" src="" class="absolute -bottom-2 -right-2 w-12 h-12 rounded-full bg-zinc-900 border-2 border-zinc-700 p-1 object-contain" onerror="this.style.display='none'">
                </div>
                
                <div class="text-center md:text-left flex-1">
                    <h2 id="m-name" class="text-4xl font-black tracking-tight leading-none mb-2">Player Name</h2>
                    <p id="m-needed" class="text-2xl font-bold text-orange-500 mb-1">Needs 50 Points</p>
                    <div class="flex items-center justify-center md:justify-start gap-2 text-sm text-zinc-400 font-mono">
                        <span id="m-current">Current: 0</span>
                        <span>‚Ä¢</span>
                        <span id="m-target">Target: 0</span>
                    </div>
                </div>
            </div>

            <!-- Content Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                
                <!-- Stats Column -->
                <div class="space-y-4">
                    <div class="bg-zinc-800/50 p-4 rounded-xl border border-white/5 flex justify-between items-center">
                        <div>
                            <p class="text-xs text-zinc-500 uppercase font-bold">Season Avg</p>
                            <p id="m-season-avg" class="text-2xl font-black text-white">--</p>
                        </div>
                        <div class="h-8 w-1 bg-white/10 rounded-full"></div>
                    </div>
                    
                    <div class="bg-zinc-800/50 p-4 rounded-xl border border-white/5 flex justify-between items-center">
                        <div>
                            <p class="text-xs text-zinc-500 uppercase font-bold">Last 5 Games</p>
                            <p id="m-last5-avg" class="text-2xl font-black text-white">--</p>
                        </div>
                        <div class="h-8 w-1 bg-white/10 rounded-full"></div>
                    </div>
                </div>

                <!-- Next Game / Betting Column -->
                <div class="space-y-4">
                    <!-- Next Game Card -->
                    <div id="m-next-game-card" class="bg-gradient-to-br from-zinc-800 to-zinc-900 p-4 rounded-xl border border-white/10 relative overflow-hidden group">
                        <div class="absolute top-0 right-0 p-2 opacity-10 group-hover:opacity-20 transition-opacity">
                            <i class="fa-solid fa-calendar text-4xl"></i>
                        </div>
                        <p class="text-xs text-zinc-500 uppercase font-bold mb-3">Next Matchup</p>
                        
                        <div class="flex items-center gap-4">
                            <img id="m-opp-logo" src="" class="w-12 h-12 object-contain bg-white/5 rounded-lg p-1" onerror="this.src='https://placehold.co/50x50/333/FFF?text=VS'">
                            <div>
                                <p id="m-game-vs" class="font-bold text-lg leading-tight">vs OPP</p>
                                <p id="m-game-time" class="text-xs text-zinc-400 font-mono mt-1">Today 7:00 PM</p>
                            </div>
                        </div>
                    </div>

                    <!-- Betting Line -->
                    <div class="bg-zinc-800/30 p-4 rounded-xl border border-white/5 flex justify-between items-center opacity-75">
                        <div class="text-left">
                            <p class="text-xs text-zinc-500 uppercase font-bold">Betting Line</p>
                            <p class="text-sm text-zinc-400">O/U Pts</p>
                        </div>
                        <div class="text-right">
                            <span class="bg-zinc-700 text-zinc-400 text-[10px] px-2 py-1 rounded font-bold tracking-wider">OFFLINE</span>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // Global to store current players for modal lookup
        let currentPlayersData = [];

        async function switchLeague(league) {
            const grid = document.getElementById('player-grid');
            const stateText = document.getElementById('state-text');
            const spinner = document.getElementById('loading-spinner');
            const title = document.getElementById('title');
            
            grid.innerHTML = '';
            spinner.classList.remove('hidden');
            stateText.innerText = "Accessing league data...";
            
            // Toggle Title Styling
            if (league === 'nba') {
                title.className = "text-7xl md:text-9xl font-black tracking-tighter glow-nba italic text-orange-500 uppercase transition-all";
                title.innerText = "HOOP TRACKER";
                spinner.className = "mb-6 w-12 h-12 border-4 border-white/10 border-t-orange-500 rounded-full animate-spin";
            } else {
                title.className = "text-7xl md:text-9xl font-black tracking-tighter glow-nhl italic text-blue-500 uppercase transition-all";
                title.innerText = "PUCK TRACKER";
                spinner.className = "mb-6 w-12 h-12 border-4 border-white/10 border-t-blue-500 rounded-full animate-spin";
            }

            try {
                const res = await fetch(`${league}_milestones.json?v=${Date.now()}`);
                if (!res.ok) throw new Error("Data not found");
                
                let players = await res.json();
                currentPlayersData = players; // Store for modal
                players.sort((a, b) => a.needed - b.needed);

                spinner.classList.add('hidden');
                stateText.innerText = players.length === 0 ? "No active milestones detected." : "";
                
                players.forEach((p, index) => {
                    const card = document.createElement('div');
                    card.className = "player-card bg-zinc-900/40 rounded-[2.5rem] p-8 border border-white/5 flex flex-col items-center text-center backdrop-blur-md";
                    card.onclick = () => openModal(index, league); // Add click handler
                    
                    const accent = league === 'nba' ? 'text-orange-500' : 'text-blue-500';
                    const urgency = p.needed <= 15 ? 'text-red-500 animate-pulse' : accent;

                    const fallbackChain = league === 'nhl' 
                        ? `this.onerror=null; this.src='https://cms.nhl.bamgrid.com/images/headshots/current/168x168/${p.player_id}.jpg'; this.onerror=function(){this.src='https://via.placeholder.com/260x190/111/fff?text=${p.player_name.charAt(0)}'}`
                        : `this.src='https://via.placeholder.com/260x190/111/fff?text=${p.player_name.charAt(0)}'`;

                    card.innerHTML = `
                        <div class="relative mb-6">
                            <img src="${p.image_url}" 
                                 onerror="${fallbackChain}" 
                                 class="w-40 h-40 object-cover rounded-full border-4 border-white/10 bg-zinc-800 shadow-2xl pointer-events-none">
                        </div>
                        <h2 class="text-3xl font-black mb-1 tracking-tight leading-tight pointer-events-none">${p.player_name}</h2>
                        <div class="px-4 py-1 rounded-full text-[10px] font-black text-zinc-500 tracking-widest uppercase mb-6 bg-white/5 border border-white/5 pointer-events-none">${p.team}</div>
                        <div class="grid grid-cols-2 gap-4 w-full mb-8 pointer-events-none">
                            <div class="bg-white/5 rounded-2xl py-3"><p class="text-[9px] text-zinc-500 font-black uppercase">Current</p><p class="text-xl font-bold">${p.current_stat.toLocaleString()}</p></div>
                            <div class="bg-white/5 rounded-2xl py-3"><p class="text-[9px] text-zinc-500 font-black uppercase">Target</p><p class="text-xl font-bold">${p.target_milestone.toLocaleString()}</p></div>
                        </div>
                        <p class="text-[10px] text-zinc-400 font-black uppercase tracking-widest mb-1 pointer-events-none">Remaining</p>
                        <p class="text-7xl font-black ${urgency} tracking-tighter pointer-events-none">${p.needed}</p>
                    `;
                    grid.appendChild(card);
                });
            } catch (e) {
                spinner.classList.add('hidden');
                stateText.innerHTML = `<div class="text-center"><div class="mb-2">Data file not found.</div><div class="text-sm font-normal text-zinc-500">Run the python script.</div></div>`;
            }
        }

        // --- MODAL LOGIC ---
        function openModal(index, league) {
            const player = currentPlayersData[index];
            const modal = document.getElementById('modal-backdrop');
            const content = document.getElementById('modal-content');
            
            // 1. Basic Info
            document.getElementById('m-name').innerText = player.player_name;
            document.getElementById('m-image').src = player.image_url;
            document.getElementById('m-current').innerText = `Current: ${player.current_stat.toLocaleString()}`;
            document.getElementById('m-target').innerText = `Target: ${player.target_milestone.toLocaleString()}`;
            
            // 2. League Specific Colors & Text
            const statType = league === 'nhl' ? "Goals" : "Points";
            const accent = league === 'nba' ? 'text-orange-500' : 'text-blue-500';
            const mNeeded = document.getElementById('m-needed');
            mNeeded.innerText = `${player.needed} ${statType} Needed`;
            mNeeded.className = `text-2xl font-bold ${accent} mb-1`;

            // 3. Stats
            document.getElementById('m-season-avg').innerText = player.season_avg ? player.season_avg : "--";
            document.getElementById('m-last5-avg').innerText = player.last_5_avg ? player.last_5_avg : "--";

            // 4. Team Logo Logic
            const teamLogo = document.getElementById('m-team-logo');
            if (league === 'nba' && player.team_id) {
                teamLogo.src = `https://cdn.nba.com/logos/nba/${player.team_id}/global/L/logo.svg`;
                teamLogo.style.display = 'block';
            } else if (league === 'nhl' && player.team) {
                teamLogo.src = `https://assets.nhle.com/logos/nhl/svg/${player.team}_light.svg`;
                teamLogo.style.display = 'block';
            } else {
                teamLogo.style.display = 'none';
            }

            // 5. Next Game Logic
            const nextGameCard = document.getElementById('m-next-game-card');
            if (player.next_game) {
                nextGameCard.style.display = 'block';
                const oppLogo = document.getElementById('m-opp-logo');
                const gameText = document.getElementById('m-game-vs');
                const gameTime = document.getElementById('m-game-time');
                
                // Set Opponent Logo
                if (league === 'nhl') {
                    oppLogo.src = `https://assets.nhle.com/logos/nhl/svg/${player.next_game.opponent}_light.svg`;
                } else {
                    // For NBA, opponent usually comes as ID or Abbrev. Assuming Abbrev for now if implemented.
                    // Fallback to placeholder if missing logic
                    oppLogo.src = 'https://placehold.co/50x50/333/FFF?text=VS';
                }

                // Set Text
                const location = player.next_game.is_home ? "vs" : "@";
                gameText.innerText = `${location} ${player.next_game.opponent}`;
                gameTime.innerText = player.next_game.date; // E.g., "Tonight 7:00 PM"
            } else {
                nextGameCard.style.display = 'none';
            }

            // Show Modal
            modal.classList.remove('hidden');
            content.classList.remove('modal-exit', 'modal-exit-active');
            content.classList.add('modal-enter-active');
        }

        function closeModal(e, force = false) {
            if (force || e.target.id === 'modal-backdrop') {
                const modal = document.getElementById('modal-backdrop');
                const content = document.getElementById('modal-content');
                
                content.classList.remove('modal-enter-active');
                content.classList.add('modal-exit-active');
                
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 200);
            }
        }

        window.onload = () => switchLeague('nba');
    </script>
</body>
</html>